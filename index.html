<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>–ò–ò –§–∏–Ω–ö–æ—É—á</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --app-height: 100vh;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        /* –§–∏–∫—Å–∏—Ä—É–µ–º –≤—ã—Å–æ—Ç—É –∏ —É–±–∏—Ä–∞–µ–º —Å–∫—Ä–æ–ª–ª —É –¥–æ–∫—É–º–µ–Ω—Ç–∞ */
        html, body {
            height: 100%;
            overflow: hidden;
        }

        body { 
            font-family: -apple-system, 'Segoe UI', sans-serif; 
            background: radial-gradient(circle at top, #e0f2fe 0, #f5f7fa 40%, #c3cfe2 100%);
            height: var(--app-height);
            color: #0f172a;
        }

        /* –û–±—â–∏–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø–æ–¥ –≤–µ—Å—å —ç–∫—Ä–∞–Ω mini-app */
        .app-root {
            position: relative;
            width: 100%;
            height: var(--app-height);
            max-width: 400px;
            margin: 0 auto;
            padding-bottom: 72px; /* –ø–æ–¥ —Ç–∞–±-–±–∞—Ä */
            overflow: hidden; /* –≤–Ω—É—Ç—Ä–∏ –Ω–µ –≤—ã–ª–µ–∑–∞–µ–º –Ω–∞—Ä—É–∂—É */
        }

        .screen { 
            display: none; 
            position: absolute;
            inset: 0;
        }
        .screen.active { 
            display: block;
            animation: slideIn 0.4s ease-out;
        }

        /* –û–±—â–∏–π —Å–∫—Ä–æ–ª–ª-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –≤—Å–µ—Ö —ç–∫—Ä–∞–Ω–æ–≤, –ö–†–û–ú–ï welcome */
        .screen-scroll {
            position: absolute;
            inset: 0;
            padding: 20px;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }

        /* –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π —ç–∫—Ä–∞–Ω ‚Äî –±–µ–∑ —Å–∫—Ä–æ–ª–ª–∞, –∫–æ–Ω—Ç–µ–Ω—Ç –ø—Ä–æ—Å—Ç–æ —Ü–µ–Ω—Ç—Ä–∏—Ä—É–µ—Ç—Å—è */
        #welcome {
            overflow: hidden;      /* —É–±–∏—Ä–∞–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–π —Å–∫—Ä–æ–ª–ª */
            padding: 20px;         /* —Å–≤–æ–π –ø–∞–¥–¥–∏–Ω–≥, –±–µ–∑ scroll-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ */
        }

        .fade-slide-up {
            opacity: 0;
            transform: translateY(16px);
            transition: opacity 260ms ease-out, transform 260ms ease-out;
        }
        .fade-slide-up.visible {
            opacity: 1;
            transform: translateY(0);
        }

        .fade-slide-soft {
            opacity: 0;
            transform: translateY(18px) scale(0.98);
            transition: opacity 280ms ease-out, transform 280ms ease-out;
        }
        .fade-slide-soft.visible {
            opacity: 1;
            transform: translateY(0) scale(1);
        }

        .welcome-hero { 
            text-align: center; 
            padding: 72px 20px 36px; 
            position: relative;
        }

        .welcome-hero-logo {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 44px;
            height: 44px;
            border-radius: 50%;
            background: #0f172a;
            color: #f9fafb;
            font-weight: 800;
            font-size: 18px;
            letter-spacing: 0.04em;
            margin-bottom: 16px;
            box-shadow: 0 8px 18px rgba(15,23,42,0.25);
            opacity: 0;
            transform: translateY(12px) scale(0.96);
            transition: opacity 260ms ease-out, transform 260ms ease-out;
        }
        .welcome-hero-logo.visible {
            opacity: 1;
            transform: translateY(0) scale(1);
        }

        .welcome-badge {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            padding: 10px 18px;
            border-radius: 999px;
            background: rgba(15,118,110,0.16);
            border: 1px solid rgba(45,212,191,0.95);
            font-size: 13px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.09em;
            color: #0b7660;
            margin-bottom: 18px;
            box-shadow: 0 10px 22px rgba(15,116,110,0.22);
            opacity: 0;
            transform: translateY(12px) scale(0.98);
            transition: opacity 260ms ease-out, transform 260ms ease-out;
        }
        .welcome-badge.visible {
            opacity: 1;
            transform: translateY(0) scale(1);
        }
        .welcome-badge span.icon {
            font-size: 18px;
        }
        .welcome-hero h1 { 
            font-size: 32px; 
            font-weight: 800; 
            line-height: 1.15;
            background: linear-gradient(135deg, #0f172a, #0f766e); 
            -webkit-background-clip: text; 
            -webkit-text-fill-color: transparent; 
            margin-bottom: 14px;
            transition: transform 280ms ease-out;
        }
        .welcome-hero-title-enter {
            transform: translateY(8px);
        }
        .welcome-hero-title-enter.visible {
            transform: translateY(0);
        }

        .welcome-subtitle {
            font-size: 15px;
            line-height: 1.5;
            color: #475569;
            margin-bottom: 22px;
        }
        .welcome-tagline {
            display: inline-flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 6px 10px;
            padding: 10px 16px;
            border-radius: 999px;
            background: rgba(15,23,42,0.04);
            font-size: 13px;
            color: #0f172a;
            font-weight: 500;
        }
        .welcome-tagline span.dot {
            opacity: 0.5;
        }

        .welcome-result {
            border-radius: 20px; 
            padding: 20px 18px; 
            margin: 22px 0 14px; 
            backdrop-filter: blur(10px);
            background: #0f172a; 
            border: 1px solid rgba(148,163,184,0.5);
            color: #e5e7eb;
            box-shadow: 0 18px 45px rgba(15,23,42,0.45);
            position: relative;
        }
        .welcome-result-main {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
            margin-bottom: 6px;
        }
        .welcome-result-amount {
            font-size: 28px; 
            font-weight: 800; 
            color: #22c55e;
            transition: transform 160ms ease-out;
        }
        .welcome-result-desc {
            font-size: 13px; 
            color: #cbd5f5;
            line-height: 1.45;
        }

        @keyframes cardGlow {
            0% { box-shadow: 0 18px 45px rgba(15,23,42,0.45); transform: translateY(0); }
            50% { box-shadow: 0 22px 55px rgba(16,185,129,0.35); transform: translateY(-1px); }
            100% { box-shadow: 0 18px 45px rgba(15,23,42,0.45); transform: translateY(0); }
        }
        .welcome-result-glow {
            animation: cardGlow 2800ms ease-in-out 800ms 2;
        }

        .welcome-result-badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            padding: 9px 16px;
            border-radius: 999px;
            background: rgba(15,118,110,0.08);
            border: 1px solid rgba(45,212,191,0.85);
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.06em;
            color: #0b7660;
            box-shadow: 0 8px 18px rgba(15,116,110,0.2);
            margin-top: 6px;
            text-align: center;
            max-width: 360px;
        }

        .back-btn { 
            position: absolute; 
            top: 20px; 
            left: 20px; 
            background: rgba(255,255,255,0.9); 
            border: none; 
            border-radius: 20px; 
            width: 44px; 
            height: 44px; 
            cursor: pointer;
            box-shadow: 0 8px 20px rgba(15,23,42,0.15); 
            z-index: 10;
        }
        .back-btn::before { content: '‚Üê'; font-size: 20px; font-weight: bold; }
        
        .btn { 
            background: linear-gradient(135deg, #10b981, #059669); 
            color: white; 
            border: none; 
            padding: 18px 36px; 
            border-radius: 18px; 
            font-size: 16px; 
            font-weight: 700; 
            width: 100%; 
            max-width: 340px; 
            cursor: pointer; 
            transition: transform 120ms ease-out, box-shadow 120ms ease-out, opacity 260ms ease-out, background 160ms ease-out;
            margin: 10px 0;
            box-shadow: 0 14px 30px rgba(16,185,129,0.35);
        }
        .btn:active { 
            transform: scale(0.96) translateY(1px); 
            box-shadow: 0 8px 18px rgba(16,185,129,0.35); 
        }
        .btn-primary-tap {
            animation: btnPulse 200ms ease-out;
        }
        @keyframes btnPulse {
            0% { transform: scale(1); }
            50% { transform: scale(0.97); }
            100% { transform: scale(1); }
        }

        .btn-secondary { background: #6b7280; box-shadow: none; }
        .btn-premium { background: linear-gradient(135deg, #f59e0b, #d97706); box-shadow: 0 12px 26px rgba(245,158,11,0.35); }
        .btn-outline { 
            background: transparent; 
            color: #0f766e; 
            border: 2px solid #10b981;
            box-shadow: none;
        }
        
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; font-weight: 600; color: #1f2933; margin-bottom: 8px; }
        .form-group select, .form-group input { width: 100%; padding: 16px; border: 2px solid #e5e7eb; 
            border-radius: 12px; font-size: 16px; background: white; }
        .form-group input:focus, .form-group select:focus { outline: none; border-color: #10b981; box-shadow: 0 0 0 1px rgba(16,185,129,0.3); }
        .checkbox-group { display: flex; align-items: center; gap: 12px; margin-bottom: 20px; }
        .checkbox-group input[type="checkbox"] { width: auto; transform: scale(1.2); }
        .checkbox-group label { font-weight: normal; }
        
        .dashboard-header { text-align: center; padding: 30px 0; }
        .goal-title { font-size: 24px; font-weight: 700; color: #1a1a1a; margin-bottom: 10px; }
        .progress-circle { width: 120px; height: 120px; border-radius: 50%; margin: 0 auto 20px; 
                          display: flex; align-items: center; justify-content: center; font-size: 28px; 
                          font-weight: 800; color: #10b981; background: conic-gradient(#10b981 0deg 270deg, #e5e7eb 270deg 360deg); }
        .progress-text { font-size: 14px; color: #666; }
        
        .action-card, .goal-card { background: white; border-radius: 16px; padding: 20px; margin-bottom: 16px; 
                      box-shadow: 0 4px 20px rgba(0,0,0,0.08); }
        .action-title { font-size: 18px; font-weight: 600; color: #1a1a1a; margin-bottom: 6px; }
        .action-desc { color: #666; font-size: 14px; margin-bottom: 16px; }
        
        .limit-warning { background: #fef3c7; border: 1px solid #f59e0b; border-radius: 12px; padding: 16px; margin: 20px 0; text-align: center; }
        .premium-badge { background: #f59e0b; color: white; padding: 4px 12px; border-radius: 20px; font-size: 12px; font-weight: 600; }
        
        .admin-panel { background: linear-gradient(45deg, #3b82f6, #1d4ed8); color: white; padding: 20px; border-radius: 16px; margin-bottom: 20px; }
        .metric { display: flex; justify-content: space-between; margin-bottom: 12px; font-size: 16px; }
        .metric-value { font-weight: 800; font-size: 24px; }
        
        .chart-container { height: 250px; position: relative; margin: 20px 0; }
        
        .tab-bar { 
            position: fixed; 
            left: 50%;
            transform: translateX(-50%);
            bottom: 0; 
            width: 100%;
            max-width: 400px;
            background: white; 
            padding: 12px 20px; 
            display: flex; 
            gap: 10px; 
            box-shadow: 0 -2px 20px rgba(0,0,0,0.1); 
            z-index: 20;
        }
        .tab-btn { flex: 1; border: none; background: none; padding: 12px 4px; font-size: 12px; color: #9ca3af; }
        .tab-btn.active { color: #10b981; font-weight: 600; }
        .tab-btn .icon { display: block; font-size: 20px; margin-bottom: 2px; }
        
        @keyframes slideIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        @keyframes gentleSwing {
            0% { transform: translateY(0); }
            25% { transform: translateY(-3px); }
            50% { transform: translateY(0); }
            75% { transform: translateY(2px); }
            100% { transform: translateY(0); }
        }
        .swing-once {
            animation: gentleSwing 220ms ease-out;
        }
    </style>
</head>
<body>
    <div class="app-root">
        <!-- –≠–ö–†–ê–ù 0: –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ UTP (–±–µ–∑ —Å–∫—Ä–æ–ª–ª–∞) -->
        <div id="welcome" class="screen active">
            <div class="welcome-hero">
                <div id="welcomeLogo" class="welcome-hero-logo">
                    <span>–§–ö</span>
                </div>

                <div class="welcome-badge" id="welcomeBadge">
                    <span class="icon">üõ°Ô∏è</span>
                    <span>–°–æ–∑–¥–∞–Ω–æ —Å —É—á–∞—Å—Ç–∏–µ–º —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–≤</span>
                </div>
                <h1 class="fade-slide-soft welcome-hero-title-enter" id="welcomeTitle">–ù–∞–≤–µ–¥–∏ –ø–æ—Ä—è–¥–æ–∫ –≤ –¥–µ–Ω—å–≥–∞—Ö –±–µ–∑ —Å—Ç—Ä–µ—Å—Å–∞</h1>
                <p class="welcome-subtitle fade-slide-up" id="welcomeSubtitle">
                    –ò–ò –§–∏–Ω–ö–æ—É—á –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç —Ö–∞–æ—Å —Å —Ñ–∏–Ω–∞–Ω—Å–∞–º–∏ –≤ –ø—Ä–æ—Å—Ç–æ–π –ø–æ—à–∞–≥–æ–≤—ã–π –ø–ª–∞–Ω: –æ—Ç –ø–µ—Ä–≤–æ–π –ø–æ–¥—É—à–∫–∏ –¥–æ –∫—Ä—É–ø–Ω–æ–π –ø–æ–∫—É–ø–∫–∏.
                </p>
                <div class="welcome-tagline fade-slide-up" id="welcomeTagline">
                    <span>–ù–∞–∫–æ–ø–∏ –ø–æ–¥—É—à–∫—É</span><span class="dot">‚Ä¢</span>
                    <span>–ó–∞–∫—Ä–æ–π –¥–æ–ª–≥–∏</span><span class="dot">‚Ä¢</span>
                    <span>–ö—É–ø–∏ –º–∞—à–∏–Ω—É</span><span class="dot">‚Ä¢</span>
                    <span>–ü–æ—Å—Ç–∞–≤—å —Å–≤–æ—é —Ü–µ–ª—å</span>
                </div>
            </div>
            
            <div class="welcome-result fade-slide-soft" id="welcomeResult">
                <div class="welcome-result-main">
                    <div>
                        <div class="welcome-result-amount" id="welcomeAmount">100 000 ‚ÇΩ</div>
                    </div>
                </div>
                <div class="welcome-result-desc">
                    –¢–≤–æ—è –ø–æ–¥—É—à–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∑–∞ 9 –º–µ—Å—è—Ü–µ–≤, –µ—Å–ª–∏ –æ—Ç–∫–ª–∞–¥—ã–≤–∞—Ç—å –≤—Å–µ–≥–æ 375 ‚ÇΩ –≤ –¥–µ–Ω—å.
                </div>
            </div>

            <div style="display:flex; justify-content:center; margin-bottom: 4px;">
                <div class="welcome-result-badge fade-slide-up" id="welcomeBottomBadge">
                    –ù–∞—á–Ω–∏ —Å —ç—Ç–æ–π —Å—É–º–º—ã ‚Äî –¥–∞–ª—å—à–µ –§–∏–Ω–ö–æ—É—á –ø–æ–º–æ–∂–µ—Ç –Ω–∞—Ä–∞—Å—Ç–∏—Ç—å –∑–∞–ø–∞—Å –∏ –∏–¥—Ç–∏ –∫ –±–æ–ª–µ–µ –∫—Ä—É–ø–Ω—ã–º —Ü–µ–ª—è–º –±–µ–∑ —Å—Ç—Ä–µ—Å—Å–∞
                </div>
            </div>
            
            <div style="display:flex; flex-direction:column; align-items:center; margin-top:14px;">
                <button class="btn fade-slide-soft" id="startBtn" onclick="onStartClick()" style="margin-bottom: 10px;">
                    üöÄ –ù–∞—á–∞—Ç—å –ø—É—Ç—å –∫ —Å–≤–æ–µ–π —Ü–µ–ª–∏
                </button>
                <p class="fade-slide-up" id="welcomeSmallText" style="font-size: 12px; color: #6b7280; max-width: 320px; text-align: center;">
                    7 –¥–Ω–µ–π –±–µ—Å–ø–ª–∞—Ç–Ω–æ. –î–∞–ª—å—à–µ ‚Äî –º–µ–Ω—å—à–µ, —á–µ–º —á–∞—à–∫–∞ –∫–æ—Ñ–µ –≤ –¥–µ–Ω—å, —á—Ç–æ–±—ã –Ω–∞–∫–æ–Ω–µ—Ü –ø–µ—Ä–µ—Å—Ç–∞—Ç—å –æ—Ç–∫–ª–∞–¥—ã–≤–∞—Ç—å –∂–∏–∑–Ω—å ¬´–Ω–∞ –ø–æ—Ç–æ–º¬ª.
                </p>
            </div>
        </div>
        
        <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è -->
        <div id="profileSetup" class="screen">
            <div class="screen-scroll">
                <button class="back-btn" onclick="showScreen('welcome')"></button>
                <div style="text-align: center; padding: 80px 20px 40px;">
                    <h1 style="font-size: 28px; font-weight: 800;">–ù–∞—Å—Ç—Ä–æ–∏–º –ø–ª–∞–Ω</h1>
                    <p style="font-size: 16px; color: #666;">–ü–∞—Ä–∞ –≤–æ–ø—Ä–æ—Å–æ–≤, —á—Ç–æ–±—ã –ò–ò –ø–æ–¥—Å—Ç—Ä–æ–∏–ª—Å—è –ø–æ–¥ —Ç–µ–±—è</p>
                </div>
                <div class="form-group">
                    <label>–î–æ—Ö–æ–¥</label>
                    <select id="incomeRange">
                        <option value="low">–¥–æ 40 000 ‚ÇΩ</option>
                        <option value="medium" selected>40‚Äì70 000 ‚ÇΩ</option>
                        <option value="high">70‚Äì120 000 ‚ÇΩ</option>
                        <option value="veryhigh">120 000 ‚ÇΩ+</option>
                    </select>
                </div>
                <div class="checkbox-group">
                    <input type="checkbox" id="hasDebt"> <label for="hasDebt">–ï—Å—Ç—å –∫—Ä–µ–¥–∏—Ç—ã</label>
                </div>
                <div class="checkbox-group">
                    <input type="checkbox" id="hasMortgage"> <label for="hasMortgage">–ï—Å—Ç—å –∏–ø–æ—Ç–µ–∫–∞</label>
                </div>
                <button class="btn" onclick="saveProfileAndShowGoals()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å</button>
            </div>
        </div>

        <!-- –°–≤–æ—è —Ü–µ–ª—å -->
        <div id="customGoal" class="screen">
            <div class="screen-scroll">
                <button class="back-btn" onclick="showScreen('goals')"></button>
                <div style="text-align: center; padding: 80px 20px 20px;">
                    <h1 style="font-size: 24px; font-weight: 800;">–°–≤–æ—è —Ü–µ–ª—å</h1>
                    <p style="font-size: 14px; color: #666;">–£–∫–∞–∂–∏, –∫ —á–µ–º—É —Ö–æ—á–µ—à—å –ø—Ä–∏–π—Ç–∏ ‚Äî —Ü–∏—Ñ—Ä–∞–º–∏ –∏ —Å—Ä–æ–∫–æ–º</p>
                </div>

                <div class="form-group">
                    <label for="customGoalTitle">–ù–∞–∑–≤–∞–Ω–∏–µ —Ü–µ–ª–∏</label>
                    <input id="customGoalTitle" type="text" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ü–µ—Ä–≤—ã–π –≤–∑–Ω–æ—Å –Ω–∞ –∞–≤—Ç–æ">
                </div>

                <div class="form-group">
                    <label for="customGoalTarget">–°—É–º–º–∞ —Ü–µ–ª–∏ (‚ÇΩ)</label>
                    <input id="customGoalTarget" type="number" min="1" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 300000">
                </div>

                <div class="form-group">
                    <label for="customGoalCurrent">–£–∂–µ –Ω–∞–∫–æ–ø–ª–µ–Ω–æ (‚ÇΩ, –º–æ–∂–Ω–æ –Ω–µ –∑–∞–ø–æ–ª–Ω—è—Ç—å)</label>
                    <input id="customGoalCurrent" type="number" min="0" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 20000">
                </div>

                <div class="form-group">
                    <label for="customGoalMonths">–°—Ä–æ–∫ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è (–º–µ—Å—è—Ü–µ–≤)</label>
                    <input id="customGoalMonths" type="number" min="1" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 12">
                </div>

                <button class="btn" onclick="saveCustomGoal()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ü–µ–ª—å</button>
            </div>
        </div>
        
        <!-- Goal Select -->
        <div id="goalSelect" class="screen">
            <div class="screen-scroll">
                <button class="back-btn" onclick="showScreen('goals')"></button>
                <h1 style="font-size: 28px; font-weight: 800; text-align: center; padding: 80px 20px 20px;">–° —á–µ–≥–æ –Ω–∞—á–Ω—ë–º?</h1>
                <div class="goal-card" onclick="selectGoal('pillow')" style="cursor: pointer;">
                    <h3>üõ°Ô∏è –§–∏–Ω–∞–Ω—Å–æ–≤–∞—è –ø–æ–¥—É—à–∫–∞</h3><div style="font-size: 14px; color: #666;">3‚Äì6 –º–µ—Å—è—Ü–µ–≤ —Ä–∞—Å—Ö–æ–¥–æ–≤</div>
                </div>
                <div class="goal-card" onclick="selectGoal('debt')" style="cursor: pointer;">
                    <h3>üí≥ –ó–∞–∫—Ä—ã—Ç—å –¥–æ–ª–≥–∏</h3><div style="font-size: 14px; color: #666;">–ö—Ä–µ–¥–∏—Ç–∫–∏, –∑–∞–π–º—ã</div>
                </div>
                <div class="goal-card" onclick="selectGoal('purchase')" style="cursor: pointer;">
                    <h3>üè† –ö—Ä—É–ø–Ω–∞—è –ø–æ–∫—É–ø–∫–∞</h3><div style="font-size: 14px; color: #666;">–ú–∞—à–∏–Ω–∞, –æ—Ç–ø—É—Å–∫</div>
                </div>
                <button class="btn" onclick="showDashboard()">–ü–æ–∫–∞–∑–∞—Ç—å –¥–µ–º–æ</button>
            </div>
        </div>
        
        <!-- Dashboard -->
        <div id="dashboard" class="screen">
            <div class="screen-scroll">
                <div class="dashboard-header">
                    <div class="goal-title" id="goalTitle">üõ°Ô∏è –§–∏–Ω–∞–Ω—Å–æ–≤–∞—è –ø–æ–¥—É—à–∫–∞</div>
                    <div class="progress-circle" id="progressCircle">30%</div>
                    <div class="progress-text" id="progressText">30 000 ‚ÇΩ –∏–∑ 100 000 ‚ÇΩ</div>
                </div>
                <div id="freemiumLimit" class="limit-warning" style="display: none;">
                    üö´ –ë–µ—Å–ø–ª–∞—Ç–Ω–æ: 1 —Ü–µ–ª—å. <span class="premium-badge">Premium ‚Üí 5 —Ü–µ–ª–µ–π</span>
                </div>
                <h3 style="font-size: 20px; font-weight: 700; margin: 30px 0 20px;">–°–µ–≥–æ–¥–Ω—è—à–Ω–∏–µ —à–∞–≥–∏</h3>
                <div id="dailyActions"></div>
                <div style="text-align: center; margin: 30px 0;">
                    <div style="font-size: 14px; color: #666; margin-bottom: 10px;">–ú–µ—Å—è—Ü: <span id="monthlySaved">2 300 ‚ÇΩ</span></div>
                    <button class="btn btn-premium" onclick="openStars()">üöÄ Premium 139 ‚ÇΩ/–º–µ—Å</button>
                </div>
            </div>
        </div>
        
        <!-- –¶–µ–ª–∏ -->
        <div id="goals" class="screen">
            <div class="screen-scroll">
                <h2 style="font-size: 24px; font-weight: 700; padding: 20px; margin-bottom: 20px;">–¢–≤–æ–∏ —Ü–µ–ª–∏</h2>
                <div id="goalsList"></div>
                <div style="margin-top: 10px;">
                    <button class="btn" onclick="showScreen('goalSelect')">üéØ –í—ã–±—Ä–∞—Ç—å –≥–æ—Ç–æ–≤—É—é —Ü–µ–ª—å</button>
                    <button class="btn btn-outline" onclick="showScreen('customGoal')">‚úèÔ∏è –ü–æ—Å—Ç–∞–≤–∏—Ç—å —Å–≤–æ—é —Ü–µ–ª—å</button>
                </div>
            </div>
        </div>
        
        <!-- –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ -->
        <div id="analytics" class="screen">
            <div class="screen-scroll">
                <button class="back-btn" onclick="showScreen('dashboard')"></button>
                <h2 style="font-size: 24px; font-weight: 700; padding: 80px 20px 20px; margin-bottom: 20px;">–†–∞—Å—Ö–æ–¥—ã</h2>
                <div class="chart-container">
                    <canvas id="expenseChart"></canvas>
                </div>
                <div style="padding: 20px; background: white; border-radius: 16px; margin: 20px;">
                    <div style="font-size: 18px; font-weight: 600;">üçï –î–æ—Å—Ç–∞–≤–∫–∞ –µ–¥—ã: 4 500 ‚ÇΩ</div>
                    <div style="color: #666; font-size: 14px;">–°–æ–∫—Ä–∞—Ç–∏ –Ω–∞ 20% ‚Üí +900 ‚ÇΩ –≤ –∫–æ–ø–∏–ª–∫—É/–º–µ—Å</div>
                </div>
            </div>
        </div>
        
        <!-- –ü—Ä–æ—Ñ–∏–ª—å -->
        <div id="profile" class="screen">
            <div class="screen-scroll">
                <div style="text-align: center; padding: 60px 20px 40px;">
                    <h1 style="font-size: 28px; font-weight: 800;">–ü—Ä–æ—Ñ–∏–ª—å</h1>
                    <div class="premium-badge" id="subscriptionStatus" style="display: none;">Premium –¥–æ 15.02</div>
                </div>
                <div style="padding: 0 20px;">
                    <button class="btn btn-premium" onclick="openStars()">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–æ–π</button>
                    <button class="btn btn-secondary" onclick="showScreen('profileSetup')">–ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å</button>
                    <div style="margin-top: 30px;">
                        <p>–î–æ—Ö–æ–¥: <span id="profileIncome">40‚Äì70–∫ ‚ÇΩ</span></p>
                        <p id="profileFlags"></p>
                    </div>
                </div>
                <div id="adminPanel" class="admin-panel" style="display: none; margin: 20px;">
                    <h3 style="margin-bottom: 20px;">üëë –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</h3>
                    <div class="metric"><span>–ê–∫—Ç–∏–≤–Ω—ã—Ö —é–∑–µ—Ä–æ–≤</span><span class="metric-value" id="adminUsers">127</span></div>
                    <div class="metric"><span>Premium</span><span class="metric-value" id="adminPremium">12</span></div>
                    <div class="metric"><span>MRR</span><span class="metric-value" id="adminMRR">1 668 ‚ÇΩ</span></div>
                    <button class="btn" onclick="sendPushAll()" style="background: white; color: #3b82f6; margin-top: 10px;">üì¢ Push –≤—Å–µ–º</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Tab bar -->
    <div class="tab-bar" style="display: none;" id="tabBar">
        <button class="tab-btn active" onclick="showScreen('dashboard')"><span class="icon">üìä</span>–ì–ª–∞–≤–Ω–∞—è</button>
        <button class="tab-btn" onclick="showScreen('goals')"><span class="icon">üéØ</span>–¶–µ–ª–∏</button>
        <button class="tab-btn" onclick="showScreen('analytics')"><span class="icon">üìà</span>–ê–Ω–∞–ª–∏—Ç–∏–∫–∞</button>
        <button class="tab-btn" onclick="showScreen('profile')"><span class="icon">üë§</span>–ü—Ä–æ—Ñ–∏–ª—å</button>
    </div>

    <script>
        function setAppHeight() {
            const tg = window.Telegram?.WebApp;
            if (tg && tg.viewportHeight) {
                document.documentElement.style.setProperty('--app-height', tg.viewportHeight + 'px');
            } else {
                document.documentElement.style.setProperty('--app-height', window.innerHeight + 'px');
            }
        }

        Telegram.WebApp.ready(); 
        Telegram.WebApp.expand();

        setAppHeight();
        window.Telegram?.WebApp?.onEvent?.('viewportChanged', setAppHeight);
        window.addEventListener('resize', setAppHeight);

        const ADMIN_ID = 6902824637;
        let userData = JSON.parse(localStorage.getItem('fincoach_user')) || {
            profile: { income: 'medium', hasDebt: false, hasMortgage: false },
            goals: [{ id: 1, type: 'pillow', title: '–§–∏–Ω–∞–Ω—Å–æ–≤–∞—è –ø–æ–¥—É—à–∫–∞', target: 100000, current: 30000 }],
            actions: [], subscription: { active: false }, userId: Telegram.WebApp.initDataUnsafe?.user?.id || Date.now().toString()
        };
        
        localStorage.setItem('fincoach_user', JSON.stringify(userData));
        let expenseChart;

        function animateWelcomeEntrance() {
            const logo = document.getElementById('welcomeLogo');
            const badge = document.getElementById('welcomeBadge');
            const title = document.getElementById('welcomeTitle');
            const subtitle = document.getElementById('welcomeSubtitle');
            const tagline = document.getElementById('welcomeTagline');
            const result = document.getElementById('welcomeResult');
            const bottomBadge = document.getElementById('welcomeBottomBadge');
            const startBtn = document.getElementById('startBtn');
            const smallText = document.getElementById('welcomeSmallText');

            const sequence = [
                { el: title, delay: 160 },
                { el: subtitle, delay: 240 },
                { el: tagline, delay: 320 },
                { el: result, delay: 400 },
                { el: bottomBadge, delay: 480 },
                { el: startBtn, delay: 560 },
                { el: smallText, delay: 620 }
            ];

            sequence.forEach(item => {
                if (!item.el) return;
                setTimeout(() => {
                    item.el.classList.add('visible');
                    if (item.el === result) {
                        result.classList.add('welcome-result-glow');
                    }
                }, item.delay);
            });

            const amountEl = document.getElementById('welcomeAmount');
            if (amountEl) {
                const target = 100000;
                const duration = 1400;
                const startDelay = 260;
                const formatter = new Intl.NumberFormat('ru-RU');
                let startTime = null;
                let logoShown = false;
                let badgeShown = false;

                function tick(now) {
                    if (!startTime) startTime = now;
                    const elapsed = now - startTime;
                    const rawProgress = Math.min(elapsed / duration, 1);
                    const progress = 1 - Math.pow(1 - rawProgress, 2);
                    const current = Math.round(target * progress);
                    amountEl.textContent = formatter.format(current) + ' ‚ÇΩ';

                    if (progress > 0.35 && !logoShown) {
                        logoShown = true;
                        logo?.classList.add('visible');
                    }
                    if (progress > 0.45 && !badgeShown) {
                        badgeShown = true;
                        badge?.classList.add('visible');
                    }

                    if (rawProgress < 1) {
                        requestAnimationFrame(tick);
                    } else {
                        amountEl.classList.add('swing-once');
                        setTimeout(() => amountEl.classList.remove('swing-once'), 260);
                        logo?.classList.add('visible');
                        badge?.classList.add('visible');
                    }
                }

                setTimeout(() => {
                    requestAnimationFrame(tick);
                }, startDelay);
            }
        }

        function onStartClick() {
            const btn = document.getElementById('startBtn');
            const amountEl = document.getElementById('welcomeAmount');
            const badgeEl = document.getElementById('welcomeBadge');

            if (btn) {
                btn.classList.remove('btn-primary-tap');
                void btn.offsetWidth;
                btn.classList.add('btn-primary-tap');
            }
            if (amountEl) {
                amountEl.classList.add('swing-once');
                setTimeout(() => amountEl.classList.remove('swing-once'), 260);
            }
            if (badgeEl) {
                badgeEl.classList.add('swing-once');
                setTimeout(() => badgeEl.classList.remove('swing-once'), 260);
            }

            showScreen('profileSetup');
        }

        function initApp() {
            if (parseInt(Telegram.WebApp.initDataUnsafe?.user?.id) === ADMIN_ID || userData.userId == ADMIN_ID) {
                document.getElementById('adminPanel').style.display = 'block';
            }
            if (document.getElementById('analytics')) initChart();

            setTimeout(animateWelcomeEntrance, 120);
        }
        
        function saveProfileAndShowGoals() {
            userData.profile.income = document.getElementById('incomeRange').value;
            userData.profile.hasDebt = document.getElementById('hasDebt').checked;
            userData.profile.hasMortgage = document.getElementById('hasMortgage').checked;
            localStorage.setItem('fincoach_user', JSON.stringify(userData));
            showScreen('goalSelect');
            document.getElementById('tabBar').style.display = 'flex';
        }
        
        function selectGoal(type) {
            if (userData.goals.length >= (userData.subscription.active ? 5 : 1)) {
                document.getElementById('freemiumLimit').style.display = 'block';
                setTimeout(() => document.getElementById('freemiumLimit').style.display = 'none', 3000);
                return;
            }
            userData.goals.push({
                id: Date.now(), 
                type, 
                title: type === 'pillow' ? '–§–∏–Ω–∞–Ω—Å–æ–≤–∞—è –ø–æ–¥—É—à–∫–∞' : 
                       type === 'debt' ? '–ó–∞–∫—Ä—ã—Ç—å –¥–æ–ª–≥–∏' : '–ö—Ä—É–ø–Ω–∞—è –ø–æ–∫—É–ø–∫–∞',
                target: 100000, 
                current: 0
            });
            localStorage.setItem('fincoach_user', JSON.stringify(userData));
            showDashboard();
        }

        function saveCustomGoal() {
            const title = document.getElementById('customGoalTitle').value.trim();
            const target = parseFloat(document.getElementById('customGoalTarget').value);
            const currentRaw = document.getElementById('customGoalCurrent').value;
            const months = parseInt(document.getElementById('customGoalMonths').value, 10);

            if (!title || !target || target <= 0 || !months || months <= 0) {
                Telegram.WebApp.showAlert('–ó–∞–ø–æ–ª–Ω–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ, —Å—É–º–º—É —Ü–µ–ª–∏ –∏ —Å—Ä–æ–∫ –≤ –º–µ—Å—è—Ü–∞—Ö.');
                return;
            }

            const current = currentRaw ? Math.max(0, parseFloat(currentRaw)) : 0;

            if (userData.goals.length >= (userData.subscription.active ? 5 : 1)) {
                Telegram.WebApp.showAlert('–ë–µ—Å–ø–ª–∞—Ç–Ω–æ –¥–æ—Å—Ç—É–ø–Ω–∞ —Ç–æ–ª—å–∫–æ 1 —Ü–µ–ª—å. –û—Ñ–æ—Ä–º–∏ Premium, —á—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å –±–æ–ª—å—à–µ.');
                return;
            }

            userData.goals.push({
                id: Date.now(),
                type: 'custom',
                title: title,
                target: target,
                current: current,
                months: months
            });

            localStorage.setItem('fincoach_user', JSON.stringify(userData));
            showDashboard();
        }
        
        function generateDailyActions() {
            const actions = [
                { title: 'üí∞ –û—Ç–ª–æ–∂–∏ 200 ‚ÇΩ', desc: '–¶–µ–ª—å –±–ª–∏–∂–µ –Ω–∞ 3 –¥–Ω—è', income: 'all' },
                { title: 'üìä –õ–∏–º–∏—Ç –¥–æ—Å—Ç–∞–≤–∫–∏', desc: '4 500 ‚Üí 3 000 ‚ÇΩ/–º–µ—Å', income: 'all' },
                { title: 'üí≥ –ü–µ—Ä–µ–ø–ª–∞—Ç–∞ –∫–∞—Ä—Ç—ã', desc: '+1 200 ‚ÇΩ/–º–µ—Å', debt: true },
                { title: 'üè† –¢–∞—Ä–∏—Ñ—ã –ñ–ö–•', desc: '–≠–∫–æ–Ω–æ–º–∏—è 500‚Äì1000 ‚ÇΩ', mortgage: true }
            ];
            
            const profile = userData.profile;
            const todayActions = actions.filter(a => 
                a.income === 'all' || (a.debt && profile.hasDebt) || (a.mortgage && profile.hasMortgage)
            ).slice(0, 3);
            
            document.getElementById('dailyActions').innerHTML = todayActions.map(action => `
                <div class="action-card">
                    <div class="action-title">${action.title}</div>
                    <div class="action-desc">${action.desc}</div>
                    <button class="btn" style="font-size: 14px; padding: 12px;" onclick="completeAction(this)">–°–¥–µ–ª–∞–Ω–æ ‚úì</button>
                </div>
            `).join('') || '<div style="text-align:center;color:#666;padding:40px">–ó–∞–≤—Ç—Ä–∞ –Ω–æ–≤—ã–µ —à–∞–≥–∏</div>';
        }
        
        function completeAction(btn) {
            btn.textContent = '‚úì –í—ã–ø–æ–ª–Ω–µ–Ω–æ!'; 
            btn.style.background = '#059669';
            Telegram.WebApp.HapticFeedback.impactOccurred('light');
            userData.actions.push({ date: new Date().toISOString(), completed: true });
            localStorage.setItem('fincoach_user', JSON.stringify(userData));
        }
        
        function updateAll() {
            updateProgressDisplay();
            generateDailyActions();
            updateGoalsList();
            updateProfileDisplay();
        }
        
        function updateProgressDisplay() {
            const goal = userData.goals[0];
            if (!goal) return;
            const percent = Math.round((goal.current / goal.target) * 100);
            document.getElementById('goalTitle').textContent = goal.title;
            document.getElementById('progressCircle').textContent = percent + '%';
            document.getElementById('progressCircle').style.background = 
                `conic-gradient(#10b981 0deg ${percent*3.6}deg, #e5e7eb ${percent*3.6}deg 360deg)`;
            document.getElementById('progressText').textContent = 
                `${goal.current.toLocaleString()} ‚ÇΩ –∏–∑ ${goal.target.toLocaleString()} ‚ÇΩ`;
        }
        
        function updateGoalsList() {
            document.getElementById('goalsList').innerHTML = userData.goals.map(goal => `
                <div class="goal-card">
                    <div>
                        <h3>${goal.title}</h3>
                        <div style="font-size: 14px; font-weight: 700; color: #10b981;">
                            ${goal.current.toLocaleString()} ‚ÇΩ –∏–∑ ${goal.target.toLocaleString()} ‚ÇΩ 
                            (${Math.round(goal.current/goal.target*100)}%)
                        </div>
                    </div>
                </div>
            `).join('');
        }
        
        function updateProfileDisplay() {
            const profile = userData.profile;
            const incomeMap = { low: '–¥–æ 40–∫', medium: '40‚Äì70–∫', high: '70‚Äì120–∫', veryhigh: '120–∫+' };
            document.getElementById('profileIncome').textContent = incomeMap[profile.income] + ' ‚ÇΩ';
            let flags = [];
            if (profile.hasDebt) flags.push('üí≥ –ö—Ä–µ–¥–∏—Ç—ã');
            if (profile.hasMortgage) flags.push('üè† –ò–ø–æ—Ç–µ–∫–∞');
            document.getElementById('profileFlags').textContent = flags.join(', ') || '–§–ª–∞–≥–æ–≤ –Ω–µ—Ç';
        }
        
        function initChart() {
            const ctx = document.getElementById('expenseChart')?.getContext('2d');
            if (!ctx) return;
            expenseChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['üçï –ï–¥–∞', 'üöó –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç', 'üè† –ñ–ö–•', 'üí≥ –ö—Ä–µ–¥–∏—Ç—ã', 'üéØ –ü—Ä–æ—á–µ–µ'],
                    datasets: [{
                        data: [4500, 3200, 2800, 1500, 4200],
                        backgroundColor: ['#10b981', '#3b82f6', '#f59e0b', '#ef4444', '#6b7280'],
                        borderWidth: 0
                    }]
                },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'bottom' } } }
            });
        }
        
        function openStars() {
            Telegram.WebApp.showAlert('Premium 139 ‚ÇΩ/–º–µ—Å (–ÆKassa —Å–∫–æ—Ä–æ)\n\n‚Ä¢ 5 —Ü–µ–ª–µ–π\n‚Ä¢ –ü–æ–ª–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞\n‚Ä¢ –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ —Å–æ–≤–µ—Ç—ã');
        }
        
        function sendPushAll() {
            Telegram.WebApp.showAlert('üì¢ Push –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –≤—Å–µ–º 127 —é–∑–µ—Ä–∞–º!');
        }
        
        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(screenId)?.classList.add('active');
            if (screenId !== 'welcome') {
                document.getElementById('tabBar').style.display = 'flex';
            } else {
                document.getElementById('tabBar').style.display = 'none';
            }
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            if (event && event.target) {
                event.target.closest('.tab-btn')?.classList.add('active');
            }
        }
        
        function showDashboard() {
            updateAll();
            showScreen('dashboard');
        }
        
        initApp();
    </script>
</body>
</html>
